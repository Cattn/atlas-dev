---
import Base from '../layouts/base.astro'
import { Search } from 'lucide-solid'
---

<Base>
  <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 join" transition:name="control">
    <input transition:persist="input" type="text" class="input bg-base-200 focus:border-base-300 focus:outline-none border-base-300 border-r-0 border-2 w-96 join-item" />
    <button class="btn btn-square join-item border-base-300 border-l-0 border-2" id="enter">
      <Search class="h-5 w-5" />
    </button>
  </div>
</Base>

<script>
  import { navigate } from 'astro:transitions/client'
  // @ts-ignore
  import { SetTransport } from "@mercuryworkshop/bare-mux"

  document.addEventListener('astro:page-load', async () => {
    if (window.location.href.includes('/route')) return
    const input = document.querySelector('input')

    input.value = ''

    input.onkeydown = (e) => {
      if (e.key == 'Enter') handleSearch()
    }
    ;(document.querySelector('#enter') as HTMLButtonElement).onclick = handleSearch

    if ('serviceWorker' in navigator) {
      await navigator.serviceWorker.register('/sw.js', { scope: '/cdn-cgi/' })
      SetTransport('EpxMod.EpoxyClient', { wisp: 'ws://anura.pro'})
    }

    function handleSearch() {
      if (!input.value) return

      navigate(`/route`)
    }
  })
</script>
